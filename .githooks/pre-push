#!/bin/bash

set -e  # Exit on error
set -x  # Print commands

echo "ğŸ” Iniciando verificaciones pre-push..."

# Verificar si golangci-lint estÃ¡ instalado
if ! command -v golangci-lint &> /dev/null; then
    echo "âŒ golangci-lint no estÃ¡ instalado. Por favor, instÃ¡lalo con:"
    echo "go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
    exit 1
fi

# Verificar si estamos en el directorio correcto
if [ ! -f "go.mod" ]; then
    echo "âŒ No se encontrÃ³ el archivo go.mod. AsegÃºrate de estar en el directorio raÃ­z del proyecto."
    exit 1
fi

# Ejecutar tests
echo "ğŸ§ª Ejecutando tests..."
go test ./... -v || {
    echo "âŒ Los tests han fallado. Por favor, corrige los errores antes de hacer push."
    exit 1
}

# Ejecutar linter
echo "ğŸ”§ Ejecutando linter..."
golangci-lint run || {
    echo "âŒ El linter ha encontrado errores. Por favor, corrige los errores antes de hacer push."
    exit 1
}

# Verificar formato del cÃ³digo
echo "ğŸ“ Verificando formato del cÃ³digo..."
go fmt ./... || {
    echo "âŒ Hay problemas con el formato del cÃ³digo. Por favor, corrige los errores antes de hacer push."
    exit 1
}

echo "âœ… Todas las verificaciones han pasado correctamente!"
exit 0 